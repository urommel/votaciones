import{r as n,j as e,L as $}from"./app-DMpQA86v.js";import{B as x,D as w,a as y,b as I,c as F}from"./dialog-CZCOUsV5.js";import{R as _,a as C}from"./radio-group-BFOnVa_2.js";import{L as k}from"./label-FtF91ial.js";import{r as B}from"./votacion-B5hyJPU0.js";const j=n.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:`rounded-lg border bg-card text-card-foreground shadow-sm ${s}`,...t}));j.displayName="Card";const p=n.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:`flex flex-col space-y-1.5 p-6 ${s}`,...t}));p.displayName="CardHeader";const u=n.forwardRef(({className:s,...t},r)=>e.jsx("h3",{ref:r,className:`text-2xl font-semibold leading-none tracking-tight ${s}`,...t}));u.displayName="CardTitle";const S=n.forwardRef(({className:s,...t},r)=>e.jsx("p",{ref:r,className:`text-sm text-muted-foreground ${s}`,...t}));S.displayName="CardDescription";const f=n.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:`p-6 pt-0 ${s}`,...t}));f.displayName="CardContent";const D=n.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:`flex items-center p-6 pt-0 ${s}`,...t}));D.displayName="CardFooter";const H=({children:s})=>e.jsx("div",{className:"text-sm text-gray-500",children:s}),z=({children:s})=>e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:s}),O=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-16 h-16 text-green-500",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),R=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-16 h-16 text-red-500",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]});function A(){var b;const[s,t]=n.useState(null),[r,m]=n.useState(""),[h,v]=n.useState(!1),[V,c]=n.useState(!1),[E,d]=n.useState(!1),[o,N]=n.useState(null);n.useEffect(()=>{const a=sessionStorage.getItem("votacionData");if(a)try{const l=JSON.parse(a);t(l)}catch(l){console.error("Error al parsear datos de votación:",l),window.location.href="/votacion-publica"}else window.location.href="/votacion-publica"},[]);const L=async()=>{if(!(!s||!r)){v(!0),c(!1);try{const a=r==="blanco",l=a?null:parseInt(r),g=await B({sediprano_id:s.votante.id,votacion_id:s.votacion.id,candidato_id:l,es_blanco:a});N({success:g.status==="success",message:g.message}),d(!0),g.status==="success"&&setTimeout(()=>{sessionStorage.removeItem("votacionData"),window.location.href="/votacion-publica"},3e3)}catch(a){N({success:!1,message:a.message||"Error al registrar tu voto. Inténtalo nuevamente."}),d(!0)}finally{v(!1)}}};if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-lg text-gray-500",children:"Cargando datos de votación..."})})});const i=r!=="blanco"&&r?s.candidatos.find(a=>a.id.toString()===r):null;return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Emitir Voto"}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-azul",children:"Emitir Voto"}),e.jsx("p",{className:"text-gray-500",children:s.votacion.nombre})]}),e.jsx("img",{src:"/img/logo-sedipro.png",alt:"SEDIPRO",className:"h-10"})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(u,{children:"Datos del Votante"})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Nombre:"}),e.jsx("p",{children:s.votante.nombre})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Código:"}),e.jsx("p",{children:s.votante.codigo})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Área:"}),e.jsx("p",{children:((b=s.votante.area)==null?void 0:b.nombre)||"—"})]})]})})]}),e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(u,{children:"Candidatos"}),e.jsx(S,{children:"Selecciona un candidato o voto en blanco"})]}),e.jsx(f,{children:e.jsxs(_,{value:r,onValueChange:m,className:"space-y-4",children:[s.candidatos.map(a=>e.jsxs("div",{className:`flex items-center space-x-2 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 ${r===a.id.toString()?"border-blue-500 bg-blue-50":"border-gray-200"}`,onClick:()=>m(a.id.toString()),children:[e.jsx(C,{id:`candidato-${a.id}`,value:a.id.toString()}),e.jsxs("div",{className:"flex items-center flex-1 space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:a.foto?e.jsx("img",{src:a.foto,alt:a.sediprano.user.name,className:"object-cover w-16 h-16 rounded-full"}):e.jsx("div",{className:"flex items-center justify-center w-16 h-16 text-gray-400 bg-gray-200 rounded-full",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(k,{htmlFor:`candidato-${a.id}`,className:"font-medium cursor-pointer",children:[a.sediprano.primer_apellido," ",a.sediprano.segundo_apellido,", ",a.sediprano.user.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.cargo.nombre," ",a.area?`- ${a.area.abreviatura}`:""]})]})]})]},a.id)),e.jsxs("div",{className:`flex items-center space-x-2 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 ${r==="blanco"?"border-blue-500 bg-blue-50":"border-gray-200"}`,onClick:()=>m("blanco"),children:[e.jsx(C,{id:"voto-blanco",value:"blanco"}),e.jsx(k,{htmlFor:"voto-blanco",className:"font-medium cursor-pointer",children:"Voto en blanco"})]})]})}),e.jsx(D,{className:"flex justify-end",children:e.jsx(x,{onClick:()=>c(!0),className:"bg-theme-azul hover:bg-theme-azul/90",disabled:!r||h,children:"Emitir Voto"})})]})]})}),e.jsx(w,{open:V,onOpenChange:c,children:e.jsxs(y,{children:[e.jsxs(I,{children:[e.jsx(F,{children:"Confirmar Voto"}),e.jsx(H,{children:"Esta acción no se puede deshacer. ¿Estás seguro de emitir tu voto?"})]}),e.jsx("div",{className:"py-4",children:r==="blanco"?e.jsx("p",{className:"font-medium",children:"Has seleccionado: Voto en blanco"}):i?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Has seleccionado al candidato:"}),e.jsxs("div",{className:"flex items-center p-3 space-x-3 border rounded-lg",children:[i.foto?e.jsx("img",{src:i.foto,alt:i.sediprano.user.name,className:"object-cover w-12 h-12 rounded-full"}):e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gray-200 rounded-full",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-gray-400",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[i.sediprano.primer_apellido," ",i.sediprano.segundo_apellido,", ",i.sediprano.user.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.cargo.nombre," ",i.area?`- ${i.area.abreviatura}`:""]})]})]})]}):e.jsx("p",{className:"text-red-600",children:"No has seleccionado ninguna opción"})}),e.jsx(z,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(x,{className:"bg-theme-azul hover:bg-theme-azul/90",onClick:L,disabled:h,children:h?"Procesando...":"Confirmar Voto"})]})})]})}),e.jsx(w,{open:E,onOpenChange:d,children:e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col items-center py-6 space-y-4 text-center",children:[o!=null&&o.success?e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx("h3",{className:"text-xl font-semibold text-green-600",children:"¡Voto Registrado!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx("h3",{className:"text-xl font-semibold text-red-600",children:"Error al Votar"})]}),e.jsx("p",{className:"text-gray-600",children:o==null?void 0:o.message}),e.jsx(x,{onClick:()=>{d(!1),o!=null&&o.success&&(window.location.href="/votacion-publica")},className:o!=null&&o.success?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700",children:o!=null&&o.success?"Finalizar":"Entendido"})]})})})]})}export{A as default};
