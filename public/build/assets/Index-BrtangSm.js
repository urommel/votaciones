import{m as D,r as n,j as e,S as _,L as $}from"./app-DMpQA86v.js";import{A as I}from"./AuthenticatedLayout-C7SyfY9Z.js";import{D as O,a as H,b as L,c as A,B as u}from"./dialog-CZCOUsV5.js";import{I as G}from"./input-DwJfKTdf.js";import{L as m}from"./label-FtF91ial.js";import{S as f}from"./select-CRV2jmID.js";import{R as q,a as F}from"./radio-group-BFOnVa_2.js";import{d as P,m as w,F as z,a as J,C as K}from"./ConfirmDialog-CUOnWxoa.js";import{B as Q}from"./badge-DAHxuvFS.js";import{F as U}from"./PlusIcon-CRYNvhOB.js";import{f as W}from"./format-DF3zju1I.js";import{e as X}from"./es-DWfJTDW_.js";function Y({isOpen:i,onClose:d,sedipranos:g,candidatos:j,votaciones:y}){const{data:s,setData:r,post:c,processing:N,errors:o,reset:x}=D({sediprano_id:"",votacion_id:"",tipo_voto:"candidato",candidato_id:"",es_blanco:!1}),[p,h]=n.useState([]);n.useEffect(()=>{if(s.votacion_id){const t=j.filter(b=>b.votacion_id===Number(s.votacion_id));h(t),r("candidato_id","")}else h([])},[s.votacion_id,j]),n.useEffect(()=>{i&&x()},[i]),n.useEffect(()=>{s.tipo_voto==="blanco"?(r("es_blanco",!0),r("candidato_id","")):r("es_blanco",!1)},[s.tipo_voto]);const v=t=>{t.preventDefault(),c(route("votos.store"),{onSuccess:()=>{x(),d()}})};return e.jsx(O,{open:i,onOpenChange:t=>!t&&d(),children:e.jsxs(H,{className:"sm:max-w-[500px]",children:[e.jsx(L,{children:e.jsx(A,{children:"Registrar Nuevo Voto"})}),e.jsxs("form",{onSubmit:v,className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"sediprano_id",children:["Sediprano que vota ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"sediprano_id",value:s.sediprano_id,onChange:t=>r("sediprano_id",t.target.value),children:[e.jsx("option",{value:"",children:"Selecciona un sediprano"}),g.map(t=>e.jsx("option",{value:t.id,children:t.user.name},t.id))]}),o.sediprano_id&&e.jsx("p",{className:"text-sm text-red-500",children:o.sediprano_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"votacion_id",children:["Votación ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"votacion_id",value:s.votacion_id,onChange:t=>r("votacion_id",t.target.value),children:[e.jsx("option",{value:"",children:"Selecciona una votación"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),o.votacion_id&&e.jsx("p",{className:"text-sm text-red-500",children:o.votacion_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Tipo de Voto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(q,{value:s.tipo_voto,onValueChange:t=>r("tipo_voto",t),className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"candidato",value:"candidato"}),e.jsx(m,{htmlFor:"candidato",className:"cursor-pointer",children:"Voto por candidato"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"blanco",value:"blanco"}),e.jsx(m,{htmlFor:"blanco",className:"cursor-pointer",children:"Voto en blanco"})]})]}),o.tipo_voto&&e.jsx("p",{className:"text-sm text-red-500",children:o.tipo_voto})]}),s.tipo_voto==="candidato"&&s.votacion_id&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"candidato_id",children:["Candidato ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"candidato_id",value:s.candidato_id,onChange:t=>r("candidato_id",t.target.value),disabled:p.length===0,children:[e.jsx("option",{value:"",children:"Selecciona un candidato"}),p.map(t=>e.jsxs("option",{value:t.id,children:[t.sediprano.user.name," - ",t.cargo.nombre,t.area?` (${t.area.abreviatura})`:""]},t.id))]}),p.length===0&&s.votacion_id&&e.jsx("p",{className:"text-sm text-amber-500",children:"No hay candidatos registrados para esta votación."}),o.candidato_id&&e.jsx("p",{className:"text-sm text-red-500",children:o.candidato_id})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:d,children:"Cancelar"}),e.jsx(u,{type:"submit",disabled:N,variant:"default",className:"!bg-theme-cyan hover:!bg-theme-cyan/90",children:"Registrar Voto"})]})]})]})})}function me({votos:i,filters:d,votaciones:g,sedipranos:j,candidatos:y}){const[s,r]=n.useState(d.search),[c,N]=n.useState(d.votacion_id?d.votacion_id.toString():""),[o,x]=n.useState(!1),[p,h]=n.useState(!1),[v,t]=n.useState(null),{delete:b}=D({}),R=n.useCallback(P(a=>{_.get(route("votos.index"),{search:a,votacion_id:c||null},{preserveState:!0,preserveScroll:!0})},300),[c]),k=a=>{r(a.target.value),R(a.target.value)},E=a=>{const l=a.target.value;N(l),_.get(route("votos.index"),{search:s,votacion_id:l||null},{preserveState:!0,preserveScroll:!0})},M=a=>{_.get(route("votos.index",{page:a}),{search:s,votacion_id:c||null},{preserveState:!0})},T=a=>{t(a),h(!0)},B=()=>{v&&b(route("votos.destroy",v.id))};return e.jsxs(I,{children:[e.jsx($,{title:"Votos"}),e.jsxs("div",{className:"p-8",children:[e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Votos"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Gestiona los votos registrados en el sistema"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:"search",placeholder:"Buscar votos...",value:s,onChange:k,className:"w-[300px] pl-10"}),e.jsx(z,{className:"absolute w-5 h-5 text-gray-400 -translate-y-1/2 left-3 top-1/2"})]}),e.jsxs(f,{value:c,onChange:E,className:"w-[250px]",children:[e.jsx("option",{value:"",children:"Todas las votaciones"}),g.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs(u,{onClick:()=>x(!0),className:"gap-2 !bg-theme-cyan hover:!bg-theme-cyan/90",children:[e.jsx(U,{className:"w-5 h-5"}),"Registrar Voto"]})]})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 bg-white shadow-sm rounded-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Sediprano"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Votación"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Voto"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-right text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.data.map((a,l)=>{var C,S,V;return e.jsxs(w.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l*.05},className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 whitespace-nowrap",children:a.sediprano.user.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:a.votacion.name}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap",children:a.es_blanco?e.jsx(Q,{className:"bg-gray-100 text-gray-800",children:"Voto en Blanco"}):e.jsxs("span",{children:[(C=a.candidato)==null?void 0:C.sediprano.user.name,(S=a.candidato)!=null&&S.cargo?` (${a.candidato.cargo.nombre})`:"",(V=a.candidato)!=null&&V.area?` - ${a.candidato.area.abreviatura}`:""]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:W(new Date(a.fecha_voto),"dd MMM yyyy HH:mm",{locale:X})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-right whitespace-nowrap",children:e.jsx(u,{onClick:()=>T(a),variant:"ghost",className:"p-1 mr-2 bg-transparent hover:bg-red-50 group",children:e.jsx(J,{className:"w-[18px] h-[18px] text-black group-hover:text-red-600"})})})]},a.id)})})]})}),i.last_page>1&&e.jsx("div",{className:"px-6 py-4 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",i.from," a ",i.to," de ",i.total," votos"]}),e.jsx("div",{className:"flex gap-2",children:i.links.map((a,l)=>a.url===null?null:e.jsx(u,{onClick:()=>M(Number(a.label)),className:`${a.active?"bg-theme-cyan border-theme-cyan text-white hover:bg-theme-cyan/90":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"} w-10 h-10 p-0 font-medium`,disabled:!a.url,children:a.label},l))})]})})]})]}),e.jsx(Y,{isOpen:o,onClose:()=>x(!1),sedipranos:j,candidatos:y.map(a=>({id:a.id,sediprano:a.sediprano,cargo:a.cargo,area:a.area,votacion_id:a.votacion_id,foto_url:a.foto})),votaciones:g}),e.jsx(K,{isOpen:p,onClose:()=>h(!1),onConfirm:B,title:"Confirmar eliminación",message:"¿Estás seguro que deseas eliminar este voto? Esta acción no se puede deshacer."})]})}export{me as default};
