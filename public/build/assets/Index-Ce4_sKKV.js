import{m as C,r as c,j as e,S as _,L as O}from"./app-DMpQA86v.js";import{A as z}from"./AuthenticatedLayout-C7SyfY9Z.js";import{D as I,a as L,b as $,c as P,B as m}from"./dialog-CZCOUsV5.js";import{I as F}from"./input-DwJfKTdf.js";import{L as u}from"./label-FtF91ial.js";import{S as f}from"./select-CRV2jmID.js";import{T as q}from"./textarea-COMWIroQ.js";import{f as b}from"./format-DF3zju1I.js";import{d as G,m as S,F as J,a as K,C as Q}from"./ConfirmDialog-CUOnWxoa.js";import{B as y}from"./badge-DAHxuvFS.js";import{F as U}from"./PlusIcon-CRYNvhOB.js";import{F as V}from"./PencilIcon-VtQjBVAG.js";import{e as W}from"./es-DWfJTDW_.js";function X({isOpen:i,onClose:d,asistencia:r,mode:n,sedipranos:h,eventos:N}){const{data:l,setData:o,post:w,put:p,processing:g,errors:t,reset:v}=C({sediprano_id:"",evento_id:"",hora_registro:b(new Date,"yyyy-MM-dd'T'HH:mm"),estado:"presente",observacion:""});c.useEffect(()=>{if(i&&n==="edit"&&r){const s=b(new Date(r.hora_registro),"yyyy-MM-dd'T'HH:mm");o({sediprano_id:r.sediprano_id.toString(),evento_id:r.evento_id.toString(),hora_registro:s,estado:r.estado,observacion:r.observacion||""})}else i&&n==="create"&&(v("sediprano_id","evento_id","observacion"),o(s=>({...s,hora_registro:b(new Date,"yyyy-MM-dd'T'HH:mm"),estado:"presente"})))},[i,r,n]);const j=s=>{s.preventDefault(),n==="create"?w(route("asistencias.store"),{onSuccess:()=>{v(),d()}}):p(route("asistencias.update",r==null?void 0:r.id),{onSuccess:()=>{d()}})};return e.jsx(I,{open:i,onOpenChange:s=>!s&&d(),children:e.jsxs(L,{className:"sm:max-w-[500px]",children:[e.jsx($,{children:e.jsx(P,{children:n==="create"?"Registrar Asistencia":"Editar Asistencia"})}),e.jsxs("form",{onSubmit:j,className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"sediprano_id",children:["Sediprano ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"sediprano_id",value:l.sediprano_id,onChange:s=>o("sediprano_id",s.target.value),disabled:n==="edit",children:[e.jsx("option",{value:"",children:"Selecciona un sediprano"}),h.map(s=>e.jsx("option",{value:s.id,children:s.user.name},s.id))]}),t.sediprano_id&&e.jsx("p",{className:"text-sm text-red-500",children:t.sediprano_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"evento_id",children:["Evento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"evento_id",value:l.evento_id,onChange:s=>o("evento_id",s.target.value),disabled:n==="edit",children:[e.jsx("option",{value:"",children:"Selecciona un evento"}),N.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]}),t.evento_id&&e.jsx("p",{className:"text-sm text-red-500",children:t.evento_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"hora_registro",children:["Fecha y Hora ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"hora_registro",type:"datetime-local",value:l.hora_registro,onChange:s=>o("hora_registro",s.target.value)}),t.hora_registro&&e.jsx("p",{className:"text-sm text-red-500",children:t.hora_registro})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"estado",children:["Estado ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(f,{id:"estado",value:l.estado,onChange:s=>o("estado",s.target.value),children:[e.jsx("option",{value:"presente",children:"Presente"}),e.jsx("option",{value:"tardanza",children:"Tardanza"}),e.jsx("option",{value:"falta",children:"Falta"})]}),t.estado&&e.jsx("p",{className:"text-sm text-red-500",children:t.estado})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"observacion",children:"Observación"}),e.jsx(q,{id:"observacion",value:l.observacion,onChange:s=>o("observacion",s.target.value),rows:3,placeholder:"Ej: Justificación o comentarios..."}),t.observacion&&e.jsx("p",{className:"text-sm text-red-500",children:t.observacion})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:d,children:"Cancelar"}),e.jsx(m,{type:"submit",disabled:g,variant:"default",className:"!bg-theme-amarillo hover:!bg-theme-amarillo/90",children:n==="create"?"Registrar":"Actualizar"})]})]})]})})}function xe({asistencias:i,filters:d,eventos:r,sedipranos:n}){const[h,N]=c.useState(d.search),[l,o]=c.useState(d.evento_id?d.evento_id.toString():""),[w,p]=c.useState(!1),[g,t]=c.useState(null),[v,j]=c.useState(!1),[s,D]=c.useState(null),{delete:E}=C({}),A=c.useCallback(G(a=>{_.get(route("asistencias.index"),{search:a,evento_id:l||null},{preserveState:!0,preserveScroll:!0})},300),[l]),M=a=>{N(a.target.value),A(a.target.value)},T=a=>{const x=a.target.value;o(x),_.get(route("asistencias.index"),{search:h,evento_id:x||null},{preserveState:!0,preserveScroll:!0})},k=a=>{_.get(route("asistencias.index",{page:a}),{search:h,evento_id:l||null},{preserveState:!0})},H=a=>{D(a),j(!0)},R=()=>{s&&E(route("asistencias.destroy",s.id))},B=a=>{switch(a){case"presente":return e.jsx(y,{className:"bg-green-100 text-green-800 border-green-200",children:"Presente"});case"tardanza":return e.jsx(y,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Tardanza"});case"falta":return e.jsx(y,{className:"bg-red-100 text-red-800 border-red-200",children:"Falta"});default:return e.jsx(y,{className:"bg-gray-100 text-gray-800",children:a})}};return e.jsxs(z,{children:[e.jsx(O,{title:"Asistencias"}),e.jsxs("div",{className:"p-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Asistencias"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Gestiona las asistencias a eventos"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(F,{type:"search",placeholder:"Buscar asistencias...",value:h,onChange:M,className:"w-[300px] pl-10"}),e.jsx(J,{className:"absolute w-5 h-5 text-gray-400 -translate-y-1/2 left-3 top-1/2"})]}),e.jsxs(f,{value:l,onChange:T,className:"w-[250px]",children:[e.jsx("option",{value:"",children:"Todos los eventos"}),r.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]}),e.jsxs(m,{onClick:()=>{t(null),p(!0)},className:"gap-2 !bg-theme-amarillo hover:!bg-theme-amarillo/90",children:[e.jsx(U,{className:"w-5 h-5"}),"Registrar Asistencia"]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 bg-white shadow-sm rounded-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Sediprano"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Evento"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Observación"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-right text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.data.map((a,x)=>e.jsxs(S.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:x*.05},className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 whitespace-nowrap",children:a.sediprano.user.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:a.evento.nombre}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:b(new Date(a.hora_registro),"dd MMM yyyy HH:mm",{locale:W})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap",children:B(a.estado)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:a.observacion||"—"}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-right whitespace-nowrap",children:[e.jsx(m,{onClick:()=>{t(a),p(!0)},variant:"ghost",className:"p-1 mr-2 bg-transparent hover:bg-blue-50 group",children:e.jsx(V,{className:"w-[18px] h-[18px] text-black group-hover:text-blue-600"})}),e.jsx(m,{onClick:()=>H(a),variant:"ghost",className:"p-1 mr-2 bg-transparent hover:bg-red-50 group",children:e.jsx(K,{className:"w-[18px] h-[18px] text-black group-hover:text-red-600"})})]})]},a.id))})]})}),i.last_page>1&&e.jsx("div",{className:"px-6 py-4 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",i.from," a ",i.to," de ",i.total," asistencias"]}),e.jsx("div",{className:"flex gap-2",children:i.links.map((a,x)=>a.url===null?null:e.jsx(m,{onClick:()=>k(Number(a.label)),className:`${a.active?"bg-theme-amarillo border-theme-amarillo text-white hover:bg-theme-amarillo/90":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"} w-10 h-10 p-0 font-medium`,disabled:!a.url,children:a.label},x))})]})})]})]}),e.jsx(X,{isOpen:w,onClose:()=>{p(!1),t(null)},asistencia:g,mode:g?"edit":"create",sedipranos:n,eventos:r}),e.jsx(Q,{isOpen:v,onClose:()=>j(!1),onConfirm:R,title:"Confirmar eliminación",message:"¿Estás seguro que deseas eliminar esta asistencia? Esta acción no se puede deshacer."})]})}export{xe as default};
