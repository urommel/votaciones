import{m as A,r as o,j as e,S as L,L as B}from"./app-DMpQA86v.js";import{A as I,F as O}from"./AuthenticatedLayout-C7SyfY9Z.js";import{D as P,a as T,b as z,c as V,B as m}from"./dialog-CZCOUsV5.js";import{I as q}from"./input-DwJfKTdf.js";import{L as v}from"./label-FtF91ial.js";import{S as w}from"./select-CRV2jmID.js";import{d as G,m as R,F as H,a as U,C as J}from"./ConfirmDialog-CUOnWxoa.js";import{F as K}from"./PlusIcon-CRYNvhOB.js";import{F as Q}from"./PencilIcon-VtQjBVAG.js";function W({isOpen:l,onClose:p,candidato:t,mode:c,sedipranos:C,cargos:_,areas:y,votaciones:S}){const{data:h,setData:i,post:N,put:j,processing:F,errors:r,reset:d,setError:b,clearErrors:k}=A({sediprano_id:"",cargo_id:"",area_id:"",votacion_id:"",foto:null}),u=o.useRef(null),[g,n]=o.useState(null);o.useEffect(()=>{l&&c==="edit"&&t?(i({sediprano_id:t.sediprano_id.toString(),cargo_id:t.cargo_id.toString(),area_id:t.area_id?t.area_id.toString():"",votacion_id:t.votacion_id.toString(),foto:null}),t.foto?n(t.foto):n(null)):l&&c==="create"&&(d(),n(null))},[l,t,c]);const D=a=>{var s;const x=((s=a.target.files)==null?void 0:s[0])||null;if(x){if(x.size>2*1024*1024){b("foto","La imagen no debe ser mayor a 2MB");return}if(!["image/jpeg","image/png","image/gif"].includes(x.type)){b("foto","El archivo debe ser una imagen (jpeg, png, gif)");return}k("foto"),i("foto",x);const f=new FileReader;f.onload=M=>{var $;n(($=M.target)==null?void 0:$.result)},f.readAsDataURL(x)}else i("foto",null),n(null)},E=a=>{a.preventDefault(),c==="create"?N(route("candidatos.store"),{onSuccess:()=>{d(),n(null),p()},forceFormData:!0}):j(route("candidatos.update",t==null?void 0:t.id),{onSuccess:()=>{p()},forceFormData:!0})};return e.jsx(P,{open:l,onOpenChange:a=>!a&&p(),children:e.jsxs(T,{className:"sm:max-w-[500px]",children:[e.jsx(z,{children:e.jsx(V,{children:c==="create"?"Nuevo Candidato":"Editar Candidato"})}),e.jsxs("form",{onSubmit:E,className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"sediprano_id",children:["Sediprano ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{id:"sediprano_id",value:h.sediprano_id,onChange:a=>i("sediprano_id",a.target.value),children:[e.jsx("option",{value:"",children:"Selecciona un sediprano"}),C.map(a=>e.jsxs("option",{value:a.id,children:[a.user.name," (",a.codigo,")"]},a.id))]}),r.sediprano_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.sediprano_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"cargo_id",children:["Cargo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{id:"cargo_id",value:h.cargo_id,onChange:a=>i("cargo_id",a.target.value),children:[e.jsx("option",{value:"",children:"Selecciona un cargo"}),_.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]}),r.cargo_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.cargo_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"area_id",children:"Área"}),e.jsxs(w,{id:"area_id",value:h.area_id,onChange:a=>i("area_id",a.target.value),children:[e.jsx("option",{value:"",children:"Selecciona un área"}),y.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]}),r.area_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.area_id})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"votacion_id",children:["Votación ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{id:"votacion_id",value:h.votacion_id,onChange:a=>i("votacion_id",a.target.value),children:[e.jsx("option",{value:"",children:"Selecciona una votación"}),S.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]}),r.votacion_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.votacion_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"foto",children:"Foto"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[g&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:g,alt:"Preview",className:"w-24 h-24 object-cover rounded-md"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("input",{ref:u,type:"file",id:"foto",onChange:D,className:"hidden",accept:"image/*"}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>{var a;return(a=u.current)==null?void 0:a.click()},children:g?"Cambiar foto":"Subir foto"}),g&&e.jsx(m,{type:"button",variant:"outline",className:"ml-2 text-red-500",onClick:()=>{i("foto",null),n(null),u.current&&(u.current.value="")},children:"Eliminar"})]})]}),r.foto&&e.jsx("p",{className:"text-sm text-red-500",children:r.foto})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:p,children:"Cancelar"}),e.jsx(m,{type:"submit",disabled:F,children:c==="create"?"Crear":"Actualizar"})]})]})]})})}function le({candidatos:l,filters:p,sedipranos:t,cargos:c,areas:C,votaciones:_}){var a,x;const[y,S]=o.useState(p.search),[h,i]=o.useState(!1),[N,j]=o.useState(null),[F,r]=o.useState(!1),[d,b]=o.useState(null),{delete:k}=A({}),u=o.useCallback(G(s=>{L.get(route("candidatos.index"),{search:s},{preserveState:!0,preserveScroll:!0})},300),[]),g=s=>{S(s.target.value),u(s.target.value)},n=s=>{L.get(route("candidatos.index",{page:s}),{search:y},{preserveState:!0})},D=s=>{b(s),r(!0)},E=()=>{d&&k(route("candidatos.destroy",d.id))};return e.jsxs(I,{children:[e.jsx(B,{title:"Candidatos"}),e.jsxs("div",{className:"p-8",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Candidatos"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Gestiona los candidatos para las elecciones"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{type:"search",placeholder:"Buscar candidatos...",value:y,onChange:g,className:"w-[300px] pl-10"}),e.jsx(H,{className:"absolute w-5 h-5 text-gray-400 -translate-y-1/2 left-3 top-1/2"})]}),e.jsxs(m,{onClick:()=>{j(null),i(!0)},className:"bg-theme-morado hover:bg-theme-morado/90 gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Nuevo Candidato"]})]})]}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 bg-white shadow-sm rounded-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Foto"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Sediprano"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Cargo"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Área"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Votación"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-right text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.data.map((s,f)=>e.jsxs(R.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.foto?e.jsx("img",{src:s.foto,alt:`Foto de ${s.sediprano.user.name}`,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-gray-400"})})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 whitespace-nowrap",children:s.sediprano.user.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:s.cargo.nombre}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.area?e.jsx("span",{className:"inline-flex px-3 py-1 text-xs font-medium text-blue-800 bg-blue-100 rounded-full",children:s.area.abreviatura}):"—"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 whitespace-nowrap",children:s.votacion.nombre}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-right whitespace-nowrap",children:[e.jsx(m,{onClick:()=>{j(s),i(!0)},variant:"ghost",className:"p-1 mr-2 bg-transparent hover:bg-blue-50 group",children:e.jsx(Q,{className:"w-[18px] h-[18px] text-black group-hover:text-blue-600"})}),e.jsx(m,{onClick:()=>D(s),variant:"ghost",className:"p-1 mr-2 bg-transparent hover:bg-red-50 group",children:e.jsx(U,{className:"w-[18px] h-[18px] text-black group-hover:text-red-600"})})]})]},s.id))})]})}),l.last_page>1&&e.jsx("div",{className:"px-6 py-4 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",l.from," a ",l.to," de ",l.total," candidatos"]}),e.jsx("div",{className:"flex gap-2",children:l.links.map((s,f)=>s.url===null?null:e.jsx(m,{onClick:()=>n(Number(s.label)),className:`${s.active?"bg-theme-morado border-theme-morado text-white hover:bg-theme-morado/90":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"} w-10 h-10 p-0 font-medium`,disabled:!s.url,children:s.label},f))})]})})]})]}),e.jsx(W,{isOpen:h,onClose:()=>{i(!1),j(null)},candidato:N,mode:N?"edit":"create",sedipranos:t,cargos:c,areas:C,votaciones:_}),e.jsx(J,{isOpen:F,onClose:()=>r(!1),onConfirm:E,title:"Confirmar eliminación",message:`¿Estás seguro que deseas eliminar al candidato ${(x=(a=d==null?void 0:d.sediprano)==null?void 0:a.user)==null?void 0:x.name}? Esta acción no se puede deshacer.`})]})}export{le as default};
